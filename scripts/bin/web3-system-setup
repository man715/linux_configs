#!/bin/bash

# Install zsh
sudo dnf install -y zsh

# Setup Config files
echo "[*] Getting config files for zsh, bash, and vim"
wget https://raw.githubusercontent.com/man715/linux_configs/main/.tmux.conf -O ~/.tmux.conf
wget https://raw.githubusercontent.com/man715/linux_configs/main/bash.bashrc -O ~/.bashrc
wget https://raw.githubusercontent.com/man715/linux_configs/main/.zshrc -O ~/.zshrc
source ~/.zshrc
wget https://raw.githubusercontent.com/man715/linux_configs/main/.vimrc -O ~/.vimrc

curl -fLo ~/.vim/autoload/plug.vim --create-dirs https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim

# Start ssh 
echo "[*] Starting SSH and enabling it on startup."
sudo systemctl enable ssh
sudo systemctl start ssh

# Install tmux and vim plugin managers
sudo dnf install -y tmux
echo "[*] Installing tmux and vim plugin managers"
git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
curl -fLo ~/.vim/autoload/plug.vim --create-dirs https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
echo "[!]You will need to open vim and run :PlugInstall!"

# Setting up python environment
echo "[*] Install Python environment"
echo "[*] Install dependencies"
sudo dnf upgrade -y
sudo dnf install -y epel-release
sudo dnf upgrade -y
sudo dnf install -y epel-release
sudo dnf install -y wget curl llvm git
sudo dnf install -y gcc zlib-devel bzip2 bzip2-devel readline-devel sqlite sqlite-devel openssl-devel tk-devel libffi-devel xz-devel
sudo dnf install -y snapd
sudo systemctl enable snapd.socket --now
sudo ln -s /var/lib/snapd/snap /snap
sudo snap install solc
sudo dnf reinstall -y snapd
sudo snap install solc


# Install RDP
sudo dnf install -y xrdp
sudo systemctl enable xrdp
sudo systemctl start xrdp

echo "[*] Download the pyenv script and run it"
sudo curl https://pyenv.run | zsh
echo "[*] PyEnv is installed"
echo "[*] Go here for some simple usage instructions:"
echo "[~] https://www.kali.org/docs/general-use/using-eol-python-versions/"
echo "[~] https://github.com/pyenv/pyenv"

exec zsh

echo "[*] Install python 2.7.18"
pyenv install -v 2.7.18
echo "[*] Install python 3.9.4"
pyenv install -v 3.9.4

# Install Python Modules
echo "[*] Install python modules"
/home/"$USER"/.pyenv/bin/pyenv global 3.9.4
/home/"$USER"/.pyenv/versions/3.9.4/bin/pip install ensurepath
/home/"$USER"/.pyenv/versions/3.9.4/bin/pip install pipx --user
/home/"$USER"/.local/bin/pipx install eth-brownie
/home/"$USER"/.pyenv/versions/3.9.4/bin/pip install web3

exec zsh
pyenv global 3.9.4

# Installing Tools
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.1/install.sh | bash
echo 'export NVM_DIR="$HOME/.nvm"' >> ~/.zshrc
echo '[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"  # This loads nvm' >> ~/.zshrc
echo '[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"  # This loads nvm bash_completion' >> ~/.zshrc
nvm install --lts
exec zsh
npm install -g truffle
npm install -g ganache-cli

# Install Web3 Audit Tools
pip install mythril
pip install slither-analyzer
pip install manticore==0.3.5 # https://github.com/crytic/etheno/issues/80
pip install etheno
pip install echidna

# Install ZSH QoL 
sudo wget https://download.opensuse.org/repositories/shells:zsh-users:zsh-autosuggestions/CentOS_8_Stream/shells:zsh-users:zsh-autosuggestions.repo -P /etc/yum.repos.d
sudo wget https://download.opensuse.org/repositories/shells:zsh-users:zsh-syntax-highlighting/CentOS_8_Stream/shells:zsh-users:zsh-syntax-highlighting.repo -P /etc/yum.repos.d
sudo dnf install zsh-syntax-highlighting
sudo dnf install zsh-autosuggestions

# Install VSCode
sudo cat << EOF >> /etc/yum.repos.d/vscode.repo
[code]
name=Visual Studio Code
baseurl=https://packages.microsoft.com/yumrepos/vscode
enabled=1
gpgcheck=1
gpgkey=https://packages.microsoft.com/keys/microsoft.asc
EOF
sudo dnf install -y code
sudo firewall-cmd --add-port=3389/tcp --permanent
sudo firewall-cmd --reload
